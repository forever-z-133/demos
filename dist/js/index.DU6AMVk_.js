import{i as _}from"./image.C5fFxm1J.js";import{u as x}from"./use-canvas.DKJ5Xgvk.js";import{g}from"./index.OUztobxQ.js";import{i as L,j as T,h as b,z as E,g as C,k,l as h,n as w,p as y,t as M,o as S}from"./vue.gVHh-qxJ.js";function B(o,f){const{onStart:s=()=>{},onMove:e=()=>{},onEnd:p=()=>{}}=f||{};let c=!1;L(()=>{o.value&&(o.value.addEventListener("touchstart",l),o.value.addEventListener("mousedown",l),window.addEventListener("touchmove",u),window.addEventListener("mousemove",u),window.addEventListener("touchend",i),window.addEventListener("mouseup",i),o.value.addEventListener("touchcancel",i))}),T(()=>{o.value&&(o.value.removeEventListener("touchstart",l),o.value.removeEventListener("mousedown",l),window.removeEventListener("touchmove",u),window.removeEventListener("mousemove",u),window.removeEventListener("touchend",i),window.removeEventListener("mouseup",i),o.value.removeEventListener("touchcancel",i))});function l(r){if(r instanceof MouseEvent&&r.button!==0)return;c=!0;const d=g(r);s(d[0])}function u(r){if(!c)return;const d=g(r);e(d[0])}function i(){c&&p(),c=!1}}function P(o){const{onEnd:f=()=>{}}=o||{};let s,e,p={left:0,top:0};function c(n,t){s=n,e=t,d()}function l(n){const t=s.getBoundingClientRect(),a=n.x-t.left,v=n.y-t.top;p={left:t.left,top:t.top},e.moveTo(a,v),e.globalCompositeOperation="destination-out"}function u(n){const{left:t=0,top:a=0}=p,v=n.x-t,m=n.y-a;e.lineTo(v,m),e.stroke()}function i(){e.globalCompositeOperation="source-over",f()}function r(){const n=e.getImageData(0,0,s.width,s.height);if(!n)return 0;const{data:t}=n;let a=0;for(let v=0;v<t.length;v+=4)t[v+3]<100&&(a+=4);return a/t.length*100}function d(){e.reset(),e.fillStyle="black",e.lineWidth=10,e.lineJoin="round",e.lineCap="round",e.globalCompositeOperation="source-over",e.fillRect(0,0,s.width,s.height)}return{initial:c,handleTouchStart:l,handleTouchMove:u,handleTouchEnd:i,getTransparentPercent:r,reset:d}}const D={class:"gua-gua-le"},O={ref:"game-box",class:"game-box"},F=["src"],G={ref:"canvas-ref"},N={class:"percent block"},A=b({title:"刮刮乐玩法",group:"libs",__name:"index",setup(o){const f=E("game-box"),s=E("canvas-ref"),e=C("0"),{initial:p,handleTouchStart:c,handleTouchMove:l,handleTouchEnd:u,getTransparentPercent:i,reset:r}=P({onEnd:d});x(s,{wrapperRef:f,contextProps:{willReadFrequently:!0},onReady(t,a){p(t,a)}}),B(f,{onStart:c,onMove:l,onEnd:u});function d(){const t=i();e.value=t.toFixed(1)}function n(){e.value="0",r()}return(t,a)=>(S(),k("div",D,[a[0]||(a[0]=h("p",{class:"block"},[w(" 使用 "),h("code",null,"Canvas"),w(" 实现刮刮乐效果 ")],-1)),h("div",O,[h("img",{src:y(_)},null,8,F),h("canvas",G,null,512)],512),h("p",N," 已刮范围："+M(e.value)+"% ",1),h("button",{class:"btn",onClick:n}," 重置 ")]))}});export{A as default};
