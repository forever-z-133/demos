<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
<meta name="renderer" content="webkit">
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection" content="telephone=no" />
<title>Document Picture-in-Picture API ç¤ºä¾‹</title>
<!--[if lt IE 9]><script>alert('æ‚¨çš„æµè§ˆå™¨ç‰ˆæœ¬è¿‡ä½ï¼Œè¯·æ›´æ–°æœ¬ç‰ˆæœ¬æµè§ˆå™¨ï¼Œæˆ–æ›´æ¢ä¸ºè¯¸å¦‚è°·æ­Œæµè§ˆå™¨çš„ç°ä»£æµè§ˆå™¨')</script><![endif]-->
<style>
#pipContent {
  width: 600px;
  height: 300px;
  background: pink;
  font-size: 20px;
}
@media (display-mode: picture-in-picture) {
  html, body { height: 100%; }
  body { margin: 0; overflow: hidden; }
  #pipContent {
    width: 100%;
    height: 100%;
    background: lightgreen;
  }
}
</style>
</head>
<body>
  <div id="container">
    <div id="pipContent">è¿™æ˜¯ä¸€ä¸ªå°†è¦æ”¾å…¥ç”»ä¸­ç”»çš„ div å…ƒç´ ï¼</div>
    <button id="clickBtn">åˆ‡æ¢ç”»ä¸­ç”»</button>
  </div>

<script>
  // æ£€æŸ¥æ˜¯å¦æ”¯æŒ PiP åŠŸèƒ½
  if ('documentPictureInPicture' in window) {
    console.log("ğŸš€ æµè§ˆå™¨æ”¯æŒ PiP åŠŸèƒ½ï¼");
  } else {
    alert("âš ï¸ å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ PiP åŠŸèƒ½ï¼Œæ›´æ–°æµè§ˆå™¨æˆ–è€…æ¢å°ç”µè„‘å§ï¼");
  }

  // è¯·æ±‚ PiP çª—å£
  document.getElementById("clickBtn").addEventListener("click", async function () {
    const pipContent = document.getElementById("pipContent");

    // è¯·æ±‚åˆ›å»ºä¸€ä¸ª PiP çª—å£
    const pipWindow = await window.documentPictureInPicture.requestWindow({
      width: 200,  // è®¾ç½®çª—å£çš„å®½åº¦
      height: 300  // è®¾ç½®çª—å£çš„é«˜åº¦
    });

    // å°†åŸå§‹å…ƒç´ å…‹éš†å¹¶æ·»åŠ åˆ° PiP çª—å£ä¸­
    pipWindow.document.body.appendChild(pipContent.cloneNode(true));

    // è®¾ç½® PiP æ ·å¼åŒæ­¥
    [...document.styleSheets].forEach((styleSheet) => {
      try {
        const cssRules = [...styleSheet.cssRules].map((rule) => rule.cssText).join('');
        const style = document.createElement('style');
        style.textContent = cssRules;
        pipWindow.document.head.appendChild(style);
      } catch (e) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = styleSheet.type;
        link.media = styleSheet.media;
        link.href = styleSheet.href ?? '';
        pipWindow.document.head.appendChild(link);
      }
    });

    pipWindow.addEventListener("enter", (event) => {
      console.log("å·²è¿›å…¥ PIP çª—å£");
    });
    pipWindow.addEventListener("pagehide", (event) => {
      console.log("å·²é€€å‡º PIP çª—å£");
    });
    pipWindow.addEventListener('focus', () => {
      console.log("PiP çª—å£è¿›å…¥äº†ç„¦ç‚¹çŠ¶æ€");
    });
    pipWindow.addEventListener('blur', () => {
      console.log("PiP çª—å£å¤±å»äº†ç„¦ç‚¹");
    });
  });

  // å…³é—­ PiP çª—å£
  // pipWindow.close();  // å¯ä»¥æ‰‹åŠ¨è°ƒç”¨å…³é—­çª—å£
</script>
</body>
</html>
